<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <!-- –ó–∞–ø—Ä–µ—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
  <title>–ê–∫—Ç–∏–≤—ã</title>
  
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  
  <style>
    /* –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏ –æ—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É */
    html, body {
      height: 100%;
      overflow-x: hidden;
      overflow-y: hidden;
    }
    /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è —Ö–µ–¥–µ—Ä–∞ */
    .fixed-header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      height: 70px; /* –≤—ã—Å–æ—Ç–∞ –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏ */
    }
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ —Å–ø–∏—Å–∫–æ–º –∑–∞–Ω–∏–º–∞–µ—Ç –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –º–µ—Å—Ç–æ –∏ —Å–∫—Ä–æ–ª–ª–∏—Ç—Å—è */
    .content {
      position: absolute;
      top: 80px; /* –æ—Ç—Å—Ç—É–ø —Ä–∞–≤–Ω—ã–π –≤—ã—Å–æ—Ç–µ —Ö–µ–¥–µ—Ä–∞ + –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–ø–∞—Å */
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 10px;
    }
    .header {
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 10px;
    }
    .home-btn-img {
      max-height: 40px;
    }
    .fixed-header h1 {
      font-size: 1.5rem;
    }
    body {
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
      font-family: 'Noto Sans JP', sans-serif;
      color: #333;
    }
    /* –ö–∞—Ä—Ç–æ—á–∫–∞ –∞–∫—Ç–∏–≤–∞ (–ø–æ–∫—É–ø–∫–∏) */
    .asset-card {
      border: none;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
      cursor: pointer;
      position: relative;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(0,0,0,0.1));
    }
    .asset-card:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }
    .asset-number {
      font-family: 'Lato', sans-serif;
      font-size: 2.5rem;
      font-weight: 700;
      margin: 0;
    }
    .asset-info p {
      margin: 0;
      font-size: 1rem;
    }
    .rarity-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: #ff9800;
      color: #fff;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    /* –õ–µ–Ω—Ç–æ—á–∫–∞ —Å –Ω–∞–ª–∏—á–∏–µ–º –ª–∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–æ–Ω–∞ */
    .token-availability {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: linear-gradient(90deg, #ffd700, #ffa500);
      color: #fff;
      font-size: 0.8rem;
      padding: 4px 8px;
      border-radius: 4px;
    }
    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ‚Äì –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –±–µ–ª—ã–π —Ñ–æ–Ω */
    .modal-content {
      border-radius: 15px;
      border: none;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      background-color: #fff;
      color: #333;
    }
    .modal-header,
    .modal-footer {
      border: none;
    }
    .modal-body p,
    .modal-body h5 {
      font-family: 'Noto Sans JP', sans-serif;
      font-size: 1rem;
    }
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–∫—Ä–æ–ª–ª–∏–Ω–≥–∞ —Å —É—á–µ—Ç–æ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ö–µ–¥–µ—Ä–∞ */
    .content {
      position: absolute;
      top: 80px;
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      padding: 10px;
    }
    /* –°—Ç–∏–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–æ–º–µ—Ä–∞ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –¥–ª—è –∞–∫—Ç–∏–≤–∞ */
    .modal-token-card {
      padding: 50px !important; /* –Ω–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ, —á–µ–º –≤ –æ–±—ã—á–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ */
      border: 1px solid #ddd;
      border-radius: 15px;
      transition: none !important;
    }
    .modal-token-card:hover {
      transform: none !important;
      box-shadow: none !important;
    }
    /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –Ω–æ–º–µ—Ä–∞ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
    .modal-token-card .asset-number {
      font-size: 3rem !important;
    }
  </style>
</head>
<body>
  <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å "–ù–∞ –≥–ª–∞–≤–Ω—É—é" -->
  <div class="container-fluid fixed-header header">
    <div class="d-flex justify-content-between align-items-center">
      <a href="/">
        <img src="/static/butons/home.png" alt="–ù–∞ –≥–ª–∞–≤–Ω—É—é" class="home-btn-img">
      </a>
      <h1 class="mb-0 text-center flex-grow-1">–ê–∫—Ç–∏–≤—ã</h1>
      <!-- –ü—É—Å—Ç–æ–π –±–ª–æ–∫ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è -->
      <div style="width:50px;"></div>
    </div>
  </div>
  
  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="container content">
    {% if all_purchased_tokens %}
      <div class="row">
        {% for item in all_purchased_tokens %}
          <div class="col-12">
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∫—É–ø–ª–µ–Ω–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ -->
            <div class="asset-card"
              {% if item.token.bg_is_image and item.token.bg_rarity == "0.1%" %}
                style="background: url('{{ item.token.bg_color }}') no-repeat center/cover; color: {{ item.token.text_color }}; border: 3px solid gold;"
              {% elif item.token.bg_is_image %}
                style="background: url('{{ item.token.bg_color }}') no-repeat center/cover; color: {{ item.token.text_color }};"
              {% else %}
                {% if 'linear-gradient' in item.token.bg_color %}
                  style="background: {{ item.token.bg_color }}; color: {{ item.token.text_color }};"
                {% else %}
                  style="background-color: {{ item.token.bg_color }}; color: {{ item.token.text_color }};"
                {% endif %}
              {% endif %}
              data-toggle="modal" data-target="#assetModal{{ loop.index }}">
              {% if item.token.overall_rarity != '–û–±—ã—á–Ω—ã–π' %}
                <div class="rarity-badge">{{ item.token.overall_rarity }}</div>
              {% endif %}
              <div class="asset-number">
                {% if 'linear-gradient' in item.token.text_color %}
                  <span style="background: {{ item.token.text_color }}; -webkit-background-clip: text; color: transparent;">
                    {{ item.token.token }}
                  </span>
                {% else %}
                  <span style="color: {{ item.token.text_color }};">
                    {{ item.token.token }}
                  </span>
                {% endif %}
              </div>
              {% if item.token.bg_availability %}
                <div class="token-availability">
                  {{ item.token.bg_availability | replace("–ù–∞–ª–∏—á–∏–µ: ", "") | replace("/", " –∏–∑ ") }}
                </div>
              {% endif %}
              <div class="asset-info mt-2">
                <p><strong>{{ item.token.bought_price }} üíé</strong></p>
                {% if item.token.bought_date %}
                  <p>{{ item.token.bought_date[:10] }}</p>
                {% endif %}
                {% if item.token.bought_source == 'auction' %}
                  <p>Auction</p>
                {% elif item.token.bought_source == 'market' %}
                  <p>Market</p>
                {% else %}
                  <p>Unknown</p>
                {% endif %}
                <p class="text-muted">–í–ª–∞–¥–µ–ª–µ—Ü: {{ item.owner_username }}</p>
              </div>
            </div>
          </div>
          
          <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ –Ω–æ–º–µ—Ä–∞ -->
          <div class="modal fade" id="assetModal{{ loop.index }}" tabindex="-1" role="dialog" aria-labelledby="assetModalLabel{{ loop.index }}" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="assetModalLabel{{ loop.index }}">–î–µ—Ç–∞–ª–∏ –Ω–æ–º–µ—Ä–∞</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –Ω–æ–º–µ—Ä–∞ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
                  <div class="text-center mb-3">
                    <div class="asset-card modal-token-card"
                      {% if item.token.bg_is_image and item.token.bg_rarity == "0.1%" %}
                        style="background: url('{{ item.token.bg_color }}') no-repeat center/cover; color: {{ item.token.text_color }}; border: 3px solid gold;"
                      {% elif item.token.bg_is_image %}
                        style="background: url('{{ item.token.bg_color }}') no-repeat center/cover; color: {{ item.token.text_color }};"
                      {% else %}
                        {% if 'linear-gradient' in item.token.bg_color %}
                          style="background: {{ item.token.bg_color }}; color: {{ item.token.text_color }};"
                        {% else %}
                          style="background-color: {{ item.token.bg_color }}; color: {{ item.token.text_color }};"
                        {% endif %}
                      {% endif %}>
                      <h4 class="asset-number">
                        {{ item.token.token }}
                      </h4>
                    </div>
                  </div>
                  <p><strong>–†–µ–¥–∫–æ—Å—Ç—å –Ω–æ–º–µ—Ä–∞:</strong> {{ item.token.number_rarity }}</p>
                  <p><strong>–†–µ–¥–∫–æ—Å—Ç—å —Ü–∏—Ñ—Ä:</strong> {{ item.token.text_rarity }}</p>
                  <p><strong>–†–µ–¥–∫–æ—Å—Ç—å —Ñ–æ–Ω–∞:</strong> {{ item.token.bg_rarity }}</p>
                  <p><strong>–û–±—â–∞—è —Ä–µ–¥–∫–æ—Å—Ç—å:</strong> {{ item.token.overall_rarity }}</p>
                  <p><strong>–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏:</strong> {{ item.token.bought_price }} üíé</p>
                  {% if item.token.bought_date %}
                    <p><strong>–î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏:</strong> {{ item.token.bought_date }}</p>
                  {% endif %}
                  {% if item.token.bought_source %}
                    <p><strong>–ò—Å—Ç–æ—á–Ω–∏–∫:</strong> {{ item.token.bought_source | capitalize }}</p>
                  {% endif %}
                  <p><strong>–í–ª–∞–¥–µ–ª–µ—Ü:</strong> {{ item.owner_username }} (ID: {{ item.owner_id }})</p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –∫—É–ø–∏–ª.</p>
    {% endif %}
  </div>
  
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º jQuery, Popper –∏ Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- –ê–≤—Ç–æ-—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ bottom sheet –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ -->
  <script>
    if (window.Telegram && Telegram.WebApp) {
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();

      // –í–µ—à–∞–µ–º –≤–∏–±—Ä–∞—Ü–∏—é –Ω–∞ –∫–ª–∏–∫–∏ –ø–æ –∫–Ω–æ–ø–∫–∞–º
      if (Telegram.WebApp.HapticFeedback) {
        const selectors = ['button', 'a.btn', '.btn-icon', 'input[type="submit"]'];
        document.querySelectorAll(selectors.join(',')).forEach(el => {
          el.addEventListener('click', () => {
            // –¢–∏–ø –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è: 'light', 'medium' –∏–ª–∏ 'heavy'
            Telegram.WebApp.HapticFeedback.impactOccurred('light');
          });
        });
      }
    }
  </script>
  
</body>
</html>
