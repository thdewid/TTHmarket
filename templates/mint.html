<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <!-- –ó–∞–ø—Ä–µ—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
  <title>–°–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- Google Fonts: Noto Sans JP –∏ Lato -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@700&display=swap" rel="stylesheet">

  <style>
    /* –§–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É, –æ—Ç–∫–ª—é—á–∞–µ–º –æ–±—â–∏–π —Å–∫—Ä–æ–ª–ª */
    html, body {
      height: 100%;
      overflow: hidden;
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans JP', sans-serif;
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
    }

    /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å (fixed header) */
    .fixed-header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 70px;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      padding: 0 15px;
      z-index: 1000;
    }
    .fixed-header h1 {
      flex: 1;
      text-align: center;
      font-size: 1.5rem;
      margin: 0;
    }
    /* –ú–∞–ª–µ–Ω—å–∫–∞—è –∏–∫–æ–Ω–∫–∞ "–¥–æ–º–æ–π" */
    .btn-home {
      width: 30px;
      height: 30px;
      object-fit: contain;
      display: block;
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ —Å–∫—Ä–æ–ª–ª–æ–º */
    .content {
      position: absolute;
      top: 80px; /* –æ—Ç—Å—Ç—É–ø –ø–æ–¥ —à–∞–ø–∫—É */
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      padding: 10px 20px;
    }

    /* –ó–æ–ª–æ—Ç–∞—è –ø–µ—Ä–µ–ª–∏–≤–∞—é—â–∞—è—Å—è –∫–∞—Ä—Ç–æ—á–∫–∞ "—Å–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä" */
.create-card {
  position: relative;
  width: 280px;
  height: 140px;
  border: none;
  border-radius: 15px;
  cursor: pointer;
  overflow: hidden;
  /* –±–∞–∑–æ–≤—ã–π –∑–æ–ª–æ—Ç–æ–π –≥—Ä–∞–¥–∏–µ–Ω—Ç */
  background: linear-gradient(
    135deg,
    #ffd700 0%,
    #ffea00 25%,
    #ffd700 50%,
    #ffea00 75%,
    #ffd700 100%
  );
  background-size: 300% 300%;
  /* –º—è–≥–∫–∞—è —Ç–µ–Ω—å –Ω–∞ –∑–æ–ª–æ—Ç–æ–º —Ñ–æ–Ω–µ */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  /* –∞–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–ª–∏–≤–∞ */
  animation: shimmer 3s ease infinite;
}

.create-card:hover {
  transform: scale(1.05);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
}

/* –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è + –∏ –Ω–∞–¥–ø–∏—Å–∏ */
.create-card .plus-sign,
.create-card .create-text {
  position: absolute;
  left: 50%;
  color: #ffffff;     /* —á–∏—Å—Ç–æ –±–µ–ª—ã–π, —Ö–æ—Ä–æ—à–æ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∏—Ä—É–µ—Ç –Ω–∞ –∑–æ–ª–æ—Ç–µ */
  text-shadow: none;  /* —É–±–∏—Ä–∞–µ–º —Ç–µ–Ω–∏ */
  display: block;
}

/* –°–∞–º –ø–ª—é—Å –ø–æ —Ü–µ–Ω—Ç—Ä—É */
.create-card .plus-sign {
  top: 50%;
  transform: translate(-50%, -50%);
  font-size: 3rem;
  line-height: 1;
}

/* –¢–µ–∫—Å—Ç –ø–æ–¥ –ø–ª—é—Å–æ–º */
.create-card .create-text {
  top: calc(50% + 2.5rem);
  transform: translateX(-50%);
  font-size: 0.9rem;
  white-space: nowrap;
}

/* Keyframes –¥–ª—è –ø–µ—Ä–µ–ª–∏–≤–∞—é—â–µ–≥–æ—Å—è —Ñ–æ–Ω–∞ */
@keyframes shimmer {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–¥–µ–ª–∞ "–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞" */
    .section-title {
      font-size: 1.5rem;
      white-space: nowrap;
    }

    /* –°—Ç–∏–ª–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–∫–µ–Ω–æ–≤ */
    .market-card {
      border: none;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
      cursor: pointer;
      position: relative;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .market-card:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    .market-number {
      font-family: 'Lato', sans-serif;
      font-size: 2.5rem;
      font-weight: 700;
      margin: 0;
    }
    .rarity-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: #ff9800;
      color: #fff;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    /* –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –º–æ–¥–∞–ª–∫–∏ –ø–æ–¥ —Å—Ç–∏–ª—å –ø—Ä–æ—Ñ–∏–ª—è */
    .modal-content {
      border-radius: 15px;
      border: none;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .modal-header,
    .modal-footer {
      border: none;
    }
    .modal-header.token-details {
      padding: 0;
      background: none !important;
      border: none !important;
    }
    .modal-token-card {
      padding: 40px !important;
    }
    .modal-token-card:hover {
      transform: none !important;
      box-shadow: none !important;
    }

    /* –ú–µ–¥–∏–∞–∑–∞–ø—Ä–æ—Å—ã */
    @media (max-width: 576px) {
      .create-card .create-text { font-size: 0.8rem; }
      .section-title { font-size: 1.2rem; }
      .market-number { font-size: 2rem; }
    }
  </style>
</head>
<body>
  <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
  <div class="fixed-header">
    <a href="/">
      <img src="/static/butons/home.png" alt="–ù–∞ –≥–ª–∞–≤–Ω—É—é" class="btn-home">
    </a>
    <h1>–°–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä</h1>
    <div style="width:30px;"></div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="content">
    {% if error %}
      <div class="alert alert-danger text-center">{{ error }}</div>
    {% endif %}

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ —Ü–µ–Ω—Ç—Ä—É -->
    <div class="row justify-content-center my-4">
      <div class="col-auto">
        <div class="create-card" data-toggle="modal" data-target="#createModal">
          <div class="plus-sign">+</div>
          <div class="create-text">–ù–∞–∂–º–∏—Ç–µ –∑–¥–µ—Å—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è NFT –Ω–æ–º–µ—Ä–∞</div>
        </div>
      </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ -->
    <h2 class="text-center mb-4 section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞</h2>
    <div class="row">
      {% for token in recent_tokens %}
        <div class="col-md-6">
          <div class="market-card"
               data-toggle="modal" data-target="#tokenModal-{{ token.token }}"
               {% if token.bg_is_image %}
                 style="background: url('{{ token.bg_color }}') no-repeat center/cover; color: {{ token.text_color }};"
               {% elif 'linear-gradient' in token.bg_color %}
                 style="background: {{ token.bg_color }}; color: {{ token.text_color }};"
               {% else %}
                 style="background-color: {{ token.bg_color }}; color: {{ token.text_color }};"
               {% endif %}>
            {% if token.overall_rarity != '–û–±—ã—á–Ω—ã–π' %}
              <div class="rarity-badge">{{ token.overall_rarity }}</div>
            {% endif %}
            <div class="market-number">
              {% if 'linear-gradient' in token.text_color %}
                <span style="background: {{ token.text_color }};
                             -webkit-background-clip: text; color: transparent;">
                  {{ token.token }}
                </span>
              {% else %}
                {{ token.token }}
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è -->
    <div class="modal fade" id="createModal" tabindex="-1" role="dialog"
         aria-labelledby="createModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="createModalLabel">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –Ω–æ–º–µ—Ä</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="text-center">
            <img src="/static/butons/tutorial.gif" alt="Tutorial" class="img-fluid">
          </div>
          <div class="modal-body">
            {% if attempts_left > 0 %}
              <p>–£ –≤–∞—Å –µ—Å—Ç—å <strong>{{ attempts_left }}</strong> –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫.</p>
              <p>–ú–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä –±–µ—Å–ø–ª–∞—Ç–Ω–æ.</p>
            {% else %}
              <p>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã.</p>
              <p>–°–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä –∑–∞ <strong>100</strong> üíé.<br>
                 –í–∞—à –±–∞–ª–∞–Ω—Å: <strong>{{ balance }}</strong> üíé.</p>
            {% endif %}
          </div>
          <div class="modal-footer">
            <form action="/mint" method="post" style="margin-bottom: 0;">
              <input type="hidden" name="user_id" value="{{ user_id }}">
              {% if attempts_left > 0 %}
                <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</button>
              {% else %}
                <button type="submit" class="btn btn-success"
                        {% if balance < 100 %}disabled{% endif %}>
                  –°–æ–∑–¥–∞—Ç—å –∑–∞ 100 üíé
                </button>
              {% endif %}
            </form>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
          </div>
        </div>
      </div>
    </div>


  <!-- Bootstrap JS –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (jQuery, Popper) -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- –ê–≤—Ç–æ-—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ bottom sheet –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ -->
  <script>
    if (window.Telegram && Telegram.WebApp) {
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();

      // –í–µ—à–∞–µ–º –≤–∏–±—Ä–∞—Ü–∏—é –Ω–∞ –∫–ª–∏–∫–∏ –ø–æ –∫–Ω–æ–ø–∫–∞–º
      if (Telegram.WebApp.HapticFeedback) {
        const selectors = ['button', 'a.btn', '.btn-icon', 'input[type="submit"]'];
        document.querySelectorAll(selectors.join(',')).forEach(el => {
          el.addEventListener('click', () => {
            // –¢–∏–ø –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è: 'light', 'medium' –∏–ª–∏ 'heavy'
            Telegram.WebApp.HapticFeedback.impactOccurred('light');
          });
        });
      }
    }
  </script>
    
</body>
</html>
