<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <!-- –ó–∞–ø—Ä–µ—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
  <title>NFT –Ω–æ–º–µ—Ä {{ token_value }}</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- Google Fonts: Noto Sans JP (–æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç) –∏ Lato (–¥–ª—è –Ω–æ–º–µ—Ä–æ–≤) -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@700&display=swap" rel="stylesheet">
  <style>
    /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ–±—â–µ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ */
    html, body {
      height: 100%;
      overflow: hidden;
    }
    /* –û–±–ª–∞—Å—Ç—å —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º, –∫–æ—Ç–æ—Ä–∞—è —Å–∫—Ä–æ–ª–ª–∏—Ç—Å—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ */
    .content {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      overflow-y: auto;
      padding: 20px;
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
      font-family: 'Noto Sans JP', sans-serif;
      color: #333;
    }
    .market-card {
      border: none;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
      cursor: pointer;
      position: relative;
      transition: box-shadow 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(0,0,0,0.1));
    }
    .market-card:hover {
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }
    .market-number {
      font-family: 'Lato', sans-serif;
      font-size: 2.5rem;
      font-weight: 700;
      margin: 0;
    }
    .market-info p {
      margin: 0;
      font-size: 1rem;
    }
    .rarity-badge {
      position: absolute;
      top: 10px; right: 10px;
      background-color: #ff9800;
      color: #fff;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    .token-availability {
      position: absolute;
      bottom: 10px; right: 10px;
      background: linear-gradient(90deg, #ffd700, #ffa500);
      color: #fff;
      font-size: 0.8rem;
      padding: 4px 8px;
      border-radius: 4px;
    }
    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫—Ä—É–≥–ª–æ–π –∫–Ω–æ–ø–∫–æ–π –Ω–∞–∑–∞–¥ –∏ —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É */
    .header-row {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
    }
    .header-row .btn-back {
      width: 2.5rem;
      height: 2.5rem;
      padding: 0;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      margin-right: 0.75rem;
    }
    .header-row h1 {
      font-size: 1.25rem;
      margin: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  </style>
</head>
<body>
  <div class="content">
    <div class="container my-4">
      <!-- –ö—Ä—É–≥–ª–∞—è –∫–Ω–æ–ø–∫–∞ "<" –∏ —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ NFT –Ω–æ–º–µ—Ä –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É -->
      <div class="header-row">
        <a href="javascript:history.back()" class="btn btn-secondary btn-back">&lt;</a>
        <h1>NFT –Ω–æ–º–µ—Ä: {{ token_value }}</h1>
      </div>
      
      {% if tokens %}
        {% for entry in tokens %}
          <div class="market-card"
               {% if entry.token.bg_is_image %}
                 style="background: url('{{ entry.token.bg_color }}') no-repeat center/cover; color: {{ entry.token.text_color }};"
               {% else %}
                 {% if 'linear-gradient' in entry.token.bg_color %}
                   style="background: {{ entry.token.bg_color }}; color: {{ entry.token.text_color }};"
                 {% else %}
                   style="background-color: {{ entry.token.bg_color }}; color: {{ entry.token.text_color }};"
                 {% endif %}
               {% endif %}>
            {% if entry.token.overall_rarity != '–û–±—ã—á–Ω—ã–π' %}
              <div class="rarity-badge">{{ entry.token.overall_rarity }}</div>
            {% endif %}
            <div class="market-number">
              {% if 'linear-gradient' in entry.token.text_color %}
                <span style="background: {{ entry.token.text_color }}; -webkit-background-clip: text; color: transparent;">
                  {{ entry.token.token }}
                </span>
              {% else %}
                <span style="color: {{ entry.token.text_color }};">
                  {{ entry.token.token }}
                </span>
              {% endif %}
            </div>
            {% if entry.token.bg_availability %}
              <div class="token-availability">
                {{ entry.token.bg_availability | replace("–ù–∞–ª–∏—á–∏–µ: ", "") | replace("/", " –∏–∑ ") }}
              </div>
            {% endif %}
            <div class="market-info mt-2">
              {% if entry.source == 'auction' %}
                <p><strong>–°—Ç–∞—Ç—É—Å:</strong> NFT –Ω–æ–º–µ—Ä –Ω–∞ –∞—É–∫—Ü–∏–æ–Ω–µ</p>
                <p><strong>–¢–µ–∫—É—â–∞—è —Å—Ç–∞–≤–∫–∞:</strong> {{ entry.current_bid }} üíé</p>
              {% elif entry.source == 'market' %}
                <p><strong>–¶–µ–Ω–∞:</strong> {{ entry.price }} üíé (–Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ)</p>
              {% else %}
                <p><strong>–†–µ–¥–∫–æ—Å—Ç—å –Ω–æ–º–µ—Ä–∞:</strong> {{ entry.token.number_rarity }}</p>
                <p><strong>–†–µ–¥–∫–æ—Å—Ç—å —Ü–∏—Ñ—Ä:</strong> {{ entry.token.text_rarity }}</p>
                <p><strong>–†–µ–¥–∫–æ—Å—Ç—å —Ñ–æ–Ω–∞:</strong> {{ entry.token.bg_rarity }}</p>
                <p><strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong> {{ entry.token.timestamp }}</p>
                <p>–í–ª–∞–¥–µ–ª–µ—Ü: <a href="/profile/{{ entry.owner_id }}">{{ entry.owner_id }}</a></p>
              {% endif %}
              {% if entry.token.bg_availability %}
                <p><strong>–ù–∞–ª–∏—á–∏–µ:</strong> {{ entry.token.bg_availability | replace("–ù–∞–ª–∏—á–∏–µ: ", "") | replace("/", " –∏–∑ ") }}</p>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      {% endif %}
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—à–∏–±–∫–∏ "NFT –Ω–æ–º–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω" -->
    {% if error %}
    <div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="errorModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="errorModalLabel">–û—à–∏–±–∫–∞</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            {{ error }}
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º jQuery, Popper –∏ Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <!-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–∞ –æ—à–∏–±–∫–∞ -->
  <script>
    $(document).ready(function(){
      {% if error %}
        $('#errorModal').modal('show');
      {% endif %}
    });
  </script>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- –ê–≤—Ç–æ-—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ bottom sheet –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ -->
  <script>
    if (window.Telegram && Telegram.WebApp) {
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();

      // –í–µ—à–∞–µ–º –≤–∏–±—Ä–∞—Ü–∏—é –Ω–∞ –∫–ª–∏–∫–∏ –ø–æ –∫–Ω–æ–ø–∫–∞–º
      if (Telegram.WebApp.HapticFeedback) {
        const selectors = ['button', 'a.btn', '.btn-icon', 'input[type="submit"]'];
        document.querySelectorAll(selectors.join(',')).forEach(el => {
          el.addEventListener('click', () => {
            // –¢–∏–ø –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è: 'light', 'medium' –∏–ª–∏ 'heavy'
            Telegram.WebApp.HapticFeedback.impactOccurred('light');
          });
        });
      }
    }
  </script>
  
</body>
</html>
